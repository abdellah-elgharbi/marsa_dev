pipeline {
	agent any
    tools {
		maven 'Maven3'
    }
    stages {
		stage("Build") {
			steps {
				sh '''
				cd back/discovery-Client
				mvn clean package -DskipTests'''
            }
        }

        stage('Docker Up Discovery Service') {
			steps {
				sh '''
                    cd back/discovery-Client
                    docker build -t discovery-service:1.2 .
                    docker run -d -p 8761:8761 --name discovery-service discovery-service:1.2
                '''
            }
        }
    }
    post {
		always {
			sh '''
                docker stop discovery-service || true
                docker rm discovery-service || true
            '''
            echo "Pipeline termin√©e"
        }
    }
}
