pipeline {
	agent any
    tools {
		maven 'Maven3'  // Nom défini dans Global Tool Configuration
    }
    stages {
		stage("Build") {
			steps {
				bat "mvn clean package -DskipTests" // Utiliser bat sur Windows
            }
        }

        stage('Docker Up Discovery Service') {
			steps {
				bat '''
                    cd back\\discovery-Client

                    docker build -t discovery-service:1.2 .
                    docker run -d -p 8761:8761 --name discovery-service discovery-service:1.2
                '''
            }
        }
    }
    post {
		always {
			bat '''
                docker stop discovery-service || exit 0
                docker rm discovery-service || exit 0
            '''
            echo "Pipeline terminée"
        }
    }
}
